<!DOCTYPE HTML>
<!-- Sample file for Charting Library
//-------------------------------------------------------------------------------------------
//Copyright 2012 by ChartIQ LLC
//-------------------------------------------------------------------------------------------
-->
<html>
<head>

<!-- Use these meta tags to bypass safari touch events on ipad, otherwise scrolling and drawing will not work -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1, maximum-scale=1">

<!-- Sample css file may be customized -->
<link rel="stylesheet" type="text/css" href="sample_style.css" media="screen" />
<!--[if IE]><link rel="stylesheet" type="text/css" href="sample_style_ie8.css" media="screen" /><![endif]-->

<!-- Sample stock prices data -->
<!--[if IE]><script type="text/javascript" src="excanvas.js"></script><![endif]-->	<!-- Use excanvas.js to support IE8. See notes in chartContainer -->
<!--[if !IE]><!--><script type="text/javascript" src="Intl.js"></script><!--<![endif]-->	<!-- W3C intl support. Use this until browsers have internal support for ECMA-402. Not compatible with IE8 -->
<!--[if !IE]><!--><script type="text/javascript" src="timezone-js-master/date.js"></script><!--<![endif]-->	<!-- Timezone support, library -->
<!--[if !IE]><!--><script type="text/javascript" src="timezone-js-master/data.js"></script><!--<![endif]-->	<!-- Timezone support, JSONP data file -->
<!--[if !IE]><!--><script type="text/javascript" src="locale-data/jsonp/en-US.js"></script><!--<![endif]-->	<!-- Include the locale files that you require -->
<!--[if !IE]><!--><script type="text/javascript" src="locale-data/jsonp/zh-Hans-CN.js"></script><!--<![endif]-->
<script type="text/javascript" src="SAMPLEDATA.js"></script>
<script type="text/javascript" src="SAMPLEINTRADAY.js"></script>

<!-- These Javascript files should be included here, before HTML -->
<script type="text/javascript" src="stxUtilities.js"></script>
<script type="text/javascript" src="stxMarket.js"></script>
<script type="text/javascript" src="stxI18N.js"></script>	<!-- Sample translation support -->
<script type="text/javascript" src="stxStudies.js"></script>
<script type="text/javascript" src="stxSocial.js"></script>	<!-- Optional social library for generating images and sharing charts -->

<!--[if IE]><script>STX.isIE8=true;</script><![endif]-->

</head>

<body onLoad="displayChart()" style="overflow:hidden">

 
<!------------------------------------------ PAGE CONTENTS ------------------------------------------>

<div id="contentWrapper">
  
  <!-- Indicator Dialogues -->
  <div id="studyDialogContainer">
  
    <!-- The studyDialog is a general purpose dialog for entering the parameters for studies. It may be customized so long
    as the id an class names remain the same. Note that it contains templates which are replicated dynamically -->
  
    <div id="studyDialog" style="display:none;" class="dialog">
      <div class="title">Study Title</div>
      <div onClick="dismissDialog('studyDialog');" class="btn close"><span class="close">Close</span></div>
      <div id="inputs">
        <div class="inputTemplate" style="display:none">
          <div class="heading">Heading</div>
          <div class="data"></div>
        </div>
      </div>
      <div id="outputs">
      <hr/>
        <div class="outputTemplate" style="display:none">
          <div class="heading">Heading</div>
          <div class="color"><span></span></div>
        </div>
      </div>
      <div onClick="createStudy();dismissDialog('studyDialog');" class="btn go">Create</div>
    </div>
  
  </div> 

    <div class="topBar">
    
        <div id="search">
            <input id="symbol" name="symbol" style="width: 70px;" autocapitalize="off" autocorrect="off" spellcheck="off" placeholder="Symbol">
        </div>
        
        <div id="options">
            <div class="btn option" onClick="setChartType('candle')">Candle</div>
            <div class="btn option" onClick="setChartType('bar')">Bar</div>
            <div class="btn option" onClick="setChartType('colored_bar')">Colored Bar</div>
            <div class="btn option" onClick="setChartType('line')">Line</div>
            <div class="btn option" onClick="setChartType('hollow_candle')">Hollow</div>
            <div class="btn option" onClick="toggleLog()">Log</div>
            <div class="btn option" onClick="toggleCrosshairs()">+</div>
            <div id="shareButton" class="btn option" onClick="STXSocial.shareChartExample()" style="display:none">Share</div>
            <div style="display:inline-block;"><a id="shareLink"></a></div>
        </div>
        
        <!-- These are very basic sample menus. You may replace these with another menuing system. Just follow the same onClick convention
		or provide proxy functions that call the same code-->
        
        <div id="menus">
            <div class="btn menu" onClick="toggleMenu('studies')">Studies <em>&#9660;</em></div>
            <div class="btn menu" onClick="toggleMenu('draw')">Draw <em>&#9660;</em></div>
            <div class="btn menu" onClick="toggleMenu('periodicity')">Period <em>&#9660;</em></div>
        </div>
        
        <div id="studies" class="studies menuSelect" style="display:none;">
          <div class="col">
            <div onClick="toggleMenu('studies');studyDialog(this,'Acc Swing');">Accumulative Swing Index</div>
            <div onClick="toggleMenu('studies');studyDialog(this, 'Aroon');">Aroon</div>
            <div onClick="toggleMenu('studies');studyDialog(this, 'Aroon Osc');">Aroon Oscillator</div>
            <div onClick="toggleMenu('studies');studyDialog(this, 'ATR');">Average True Range</div>
            <div onClick="toggleMenu('studies');studyDialog(this, 'Bollinger Bands');">Bollinger Bands</div>
            <div onClick="toggleMenu('studies');studyDialog(this, 'COG');">Center Of Gravity</div>
            <div onClick="toggleMenu('studies');studyDialog(this, 'Chaikin MF');">Chaikin Money Flow</div>
            <div onClick="toggleMenu('studies');studyDialog(this, 'Chaikin Vol');">Chaikin Volatility</div>
            <div onClick="toggleMenu('studies');studyDialog(this, 'Chande Fcst');">Chande Forecast Oscillator</div>
            <div onClick="toggleMenu('studies');studyDialog(this, 'Chande Mtm');">Chande Momentum Oscillator</div>
            <div onClick="toggleMenu('studies');studyDialog(this, 'CCI');">Commodity Channel Index</div>
            <div onClick="toggleMenu('studies');studyDialog(this, 'Coppock');">Coppock Curve</div>
            <div onClick="toggleMenu('studies');studyDialog(this, 'Detrended');">Detrended Price Oscillator</div>
            <div onClick="toggleMenu('studies');studyDialog(this, 'Directional');">Directional Movement System</div>
            <div onClick="toggleMenu('studies');studyDialog(this, 'EOM');">Ease of Movement</div>
            <div onClick="toggleMenu('studies');studyDialog(this, 'Ehler Fisher');">Ehler Fisher Transform</div>
            <div onClick="toggleMenu('studies');studyDialog(this, 'Elder Force');">Elder Force Index</div>
            <div onClick="toggleMenu('studies');studyDialog(this, 'Elder Ray');">Elder Ray</div>
            <div onClick="toggleMenu('studies');studyDialog(this, 'Fractal Chaos Bands');">Fractal Chaos Bands</div>
            <div onClick="toggleMenu('studies');studyDialog(this, 'Fractal Chaos');">Fractal Chaos Oscillator</div>
          </div>
          <div class="col">
            <div onClick="toggleMenu('studies');studyDialog(this, 'Gopala');">Gopalakrishnan Range Index</div>
            <div onClick="toggleMenu('studies');studyDialog(this, 'High Low');">High Low Bands</div>
            <div onClick="toggleMenu('studies');studyDialog(this, 'High-Low');">High Minus Low</div>
            <div onClick="toggleMenu('studies');studyDialog(this, 'HHV');">Highest High Value</div>
            <div onClick="toggleMenu('studies');studyDialog(this, 'Hist Vol');">Historical Volatility</div>
            <div onClick="toggleMenu('studies');studyDialog(this, 'Intraday Mtm');">Intraday Momentum Index</div>
            <div onClick="toggleMenu('studies');studyDialog(this, 'Keltner');">Keltner Channel</div>
            <div onClick="toggleMenu('studies');studyDialog(this, 'Klinger');">Klinger Volume Oscillator</div>
            <div onClick="toggleMenu('studies');studyDialog(this, 'Lin Fcst');">Linear Regression Forecast</div>
            <div onClick="toggleMenu('studies');studyDialog(this, 'Lin Incpt');">Linear Regression Intercept</div>
            <div onClick="toggleMenu('studies');studyDialog(this, 'Lin R2');">Linear Regression R2</div>
            <div onClick="toggleMenu('studies');studyDialog(this, 'LR Slope');">Linear Regression Slope</div>
            <div onClick="toggleMenu('studies');studyDialog(this, 'LLV');">Lowest Low Value</div>
            <div onClick="toggleMenu('studies');studyDialog(this, 'macd');">MACD</div>
            <div onClick="toggleMenu('studies');studyDialog(this, 'Mass Idx');">Mass Index</div>
            <div onClick="toggleMenu('studies');studyDialog(this, 'Med Price');">Median Price</div>
            <div onClick="toggleMenu('studies');studyDialog(this, 'Momentum');">Momentum Oscillator</div>
            <div onClick="toggleMenu('studies');studyDialog(this, 'M Flow');">Money Flow Index</div>
            <div onClick="toggleMenu('studies');studyDialog(this, 'ma');">Moving Average</div>
            <div onClick="toggleMenu('studies');studyDialog(this, 'MA Env');">Moving Average Envelope</div>
          </div>
          <div class="col">
            <div onClick="toggleMenu('studies');studyDialog(this, 'Neg Vol');">Negative Volume Index</div>
            <div onClick="toggleMenu('studies');studyDialog(this, 'On Bal Vol');">On Balance Volume</div>
            <div onClick="toggleMenu('studies');studyDialog(this, 'PSAR');">Parabolic SAR</div>
            <div onClick="toggleMenu('studies');studyDialog(this, 'Perf Idx');">Performance Index</div>
            <div onClick="toggleMenu('studies');studyDialog(this, 'Pos Vol');">Positive Volume Index</div>
            <div onClick="toggleMenu('studies');studyDialog(this, 'Pretty Good');">Pretty Good Oscillator</div>
            <div onClick="toggleMenu('studies');studyDialog(this, 'Price Osc');">Price Oscillator</div>
            <div onClick="toggleMenu('studies');studyDialog(this, 'Price ROC');">Price Rate of Change</div>
            <div onClick="toggleMenu('studies');studyDialog(this, 'Price Vol');">Price Volume Trend</div>
            <div onClick="toggleMenu('studies');studyDialog(this, 'Prime Number Bands');">Prime Number Bands</div>
            <div onClick="toggleMenu('studies');studyDialog(this, 'Prime Number');">Prime Number Oscillator</div>
            <div onClick="toggleMenu('studies');studyDialog(this, 'QStick');">QStick</div>
            <div onClick="toggleMenu('studies');studyDialog(this, 'Random Walk');">Random Walk Index</div>
            <div onClick="toggleMenu('studies');studyDialog(this, 'RAVI');">RAVI</div>
            <div onClick="toggleMenu('studies');studyDialog(this, 'rsi');">RSI</div>
            <div onClick="toggleMenu('studies');studyDialog(this, 'Schaff');">Schaff Trend Cycle</div>
            <div onClick="toggleMenu('studies');studyDialog(this, 'STD Dev');">Standard Deviation</div>
            <div onClick="toggleMenu('studies');studyDialog(this, 'stochastics');">Stochastics</div>
            <div onClick="toggleMenu('studies');studyDialog(this, 'Stch Mtm');">Stochastic Momentum Index</div>
            <div onClick="toggleMenu('studies');studyDialog(this, 'stochastics');">Stochastic Oscillator</div>
          </div>
          <div class="col">
            <div onClick="toggleMenu('studies');studyDialog(this, 'Swing');">Swing Index</div>
            <div onClick="toggleMenu('studies');studyDialog(this, 'Time Fcst');">Time Series Forecast</div>
            <div onClick="toggleMenu('studies');studyDialog(this, 'Trade Vol');">Trade Volume Index</div>
            <div onClick="toggleMenu('studies');studyDialog(this, 'TRIX');">TRIX</div>
            <div onClick="toggleMenu('studies');studyDialog(this, 'True Range');">True Range</div>
            <div onClick="toggleMenu('studies');studyDialog(this, 'Twiggs');">Twiggs Money Flow</div>
            <div onClick="toggleMenu('studies');studyDialog(this, 'Typical Price');">Typical Price</div>
            <div onClick="toggleMenu('studies');studyDialog(this, 'Ultimate');">Ultimate Oscillator</div>
            <div onClick="toggleMenu('studies');studyDialog(this, 'VT HZ Filter');">Vertical Horizontal Filter</div>
            <div onClick="toggleMenu('studies');createVolumePanel();">Volume</div>
            <div onClick="toggleMenu('studies');toggleVolumeUnderlay();">Vol Underlay</div>
            <div onClick="toggleMenu('studies');studyDialog(this, 'Vol Osc');">Volume Oscillator</div>
            <div onClick="toggleMenu('studies');studyDialog(this, 'Vol ROC');">Volume Rate of Change</div>
            <div onClick="toggleMenu('studies');studyDialog(this, 'Weighted Close');">Weighted Close</div>
            <div onClick="toggleMenu('studies');studyDialog(this, 'Williams %R');">Williams %R</div>
            <div onClick="toggleMenu('studies');studyDialog(this, 'W Acc Dist');">Williams Accumulation Distribution</div>
          </div>
        </div>
        
        <div id="draw" class="draw menuSelect" style="display:none;">
            <div onClick="toggleMenu('draw');setVectorType('annotation');">Annotation</div>
            <div onClick="toggleMenu('draw');setVectorType('fib retrace');">Fibonacci</div>
            <div onClick="toggleMenu('draw');setVectorType('horizontal');">Horizontal</div>
            <div onClick="toggleMenu('draw');setVectorType('line');">Line</div>
            <div onClick="toggleMenu('draw');setVectorType('ray');">Ray</div>
            <div onClick="toggleMenu('draw');setVectorType('segment');">Segment</div>
            <div onClick="toggleMenu('draw');setVectorType('');">None</div>
        </div>
        
        <div id="periodicity" class="periodicity menuSelect" style="display:none;">
            <div onClick="toggleMenu('periodicity');setPeriodicity(1,'day')">1 Day</div>
            <div onClick="toggleMenu('periodicity');setPeriodicity(1,'week')">1 Week</div>
        </div>
    </div>
  <div id="chartWrapper">
    <!-- This is the container for the chart itself. This div will be passed in to the STXChart object. You may place this
    anywhere on your page. Keep the chartControls div embedded within the container for full functionality. The chart canvas
    will automatically size itself to the dimensions of the chartContainer but it will not automatically resize if the container
    dimensions change. Therefore, if your container is limited by screen dimensions then you must detect screen resizing events
    and call STXChart.resizeChart() when those events happen. For instance, on a mobile device when an orientation change occurs.
    -->
    <div id="chartContainer">
    <!--
    IE8 is supported through the excanvas.js library. For IE8, canvas elements must be included in the html
    code itself. The library will clone these canvases internally. If you don't plan on supporting IE8 you
    can safely remove these elements.
    -->
    <!--[if IE]><canvas id="ie8canvas" width="0" height="0" style="display:none"></canvas><![endif]-->
    <!--[if IE]><canvas id="ie8canvasTemp" width="0" height="0" style="display:none"></canvas><![endif]-->
    
    <!------------------------------------------ CHART TEMPLATES  ------------------------------------------>
	    <!-- Chart Controls (Includes zooming/panning and "jump" to today) -->
	    <div id="chartControls" style="display:none">
	    	<div id="loadMore" class="more" onMouseOver="modalBegin()" onMouseOut="modalEnd()" style="display:none"><span>Load More</span></div>
	      <div id="chartSize">
	        <span id="zoomOut" onMouseOver="modalBegin()" onMouseOut="modalEnd()" class="minus">-</span>
	        <span id="zoomIn" onMouseOver="modalBegin()" onMouseOut="modalEnd()" class="plus">-</span>
	      </div>
	      <div id="home" class="home" style="display:none"><span>Today</span></div>
	    </div>
	
	    <!-- These are html "templates" they are hidden html components which are replicated by the STXChart object
	    to create the chart controls. Customization of these is not recommended -->
	
	    <div id="iconsTemplate" class="icons" style="display: none;">
	      <div id="iconsTitle">Title</div>
	      <div class="btn"><span class="up">&nbsp;</span></div>
	      <div class="btn"><span class="focus">&nbsp;</span></div>
	      <div class="btn"><span class="down">&nbsp;</span></div>
	    </div>
	    <div id="closeXTemplate" class="closeX" style="position: absolute; left: 0px; top: 0px; display: none;">
	      <div class="btn"><span class="trash">&nbsp;</span></div>
	    </div>
	
	    <!-- Panel Size Control -->
	    <div id="handleTemplate" class="handle" style="display: none;"><span>Drag</span></div> 
	    <!-- Chart Floating Overlay Templates -->
	    <div id="floatDate" class="hd" style="display: none;"></div>
	    <div id="floatVolume" class="hd" style="display: none;"></div>
	    <div id="floatHR" class="vd" style="display: none;"></div>
	    <div id="currentHR" class="vd" style="display: none;"></div>
	    <div id="showMeasure" class="showMeasure"> <span id="sMeasure">measure</span> <span id="vectorTrashCan" class="btn" style="display:none"><span class="trash">&nbsp;</span></span> </div>
	    <div id="mSticky"> <span id="mStickyInterior"></span> <span id="overlayTrashCan" class="btn" style="display:none"><span class="trash">&nbsp;</span></span> </div>
	    <span id="annotationSave" class="click">save</span> <span id="annotationCancel" style="margin-left:10px;" class="click">cancel</span>
	    <div id="crossY" class="stx_crosshair"></div>
	    <div id="crossX" class="stx_crosshair"></div>
	  </div>
  </div>  
</div>

<!--
Include these files *after* the required HTML components
-->
<script type="text/javascript" src="stxChart.js"></script>
<script type="text/javascript" charset="ISO-8859-1" src="stxModulus.js"></script>
<script type="text/javascript" charset="ISO-8859-1" src="stxKernelOs.js"></script>
<script>

// Declare a STXChart object. This is the main object for drawing charts
var stxx=new STXChart();
stxx.manageTouchAndMouse=true;
//stxx.translationCallback=stxTranslate(stxWordList);	// Optional. For multi-lingual usage, pass in your own word list, or set your own translation callback
//stxx.setLocale("zh-Hans-CN");							// Optional but recommended. Set locale in order to localize dates and numbers.
//stxx.setTimeZone("America/New_York","Pacific/Honolulu"); // Optionally set alternate timezone. First timezone is the zone the data comes from. The second zone is the zone for which to display, if left blank it will display in the browser's local time.

//Once a JavaScript array of quotes is in the required format, these are the steps necessary to render a chart
function loadChart(symbol, quotes){
	// The market times are only necessary if you are displaying intraday charts. If so, be sure to set the times
	// accordingly for your exchange
	stxx.chart.beginHour=9;
	stxx.chart.beginMinute=30;
	stxx.chart.endHour=16;
	stxx.chart.endMinute=0;
	stxx.chart.minutesInSession=390;
	
	stxx.chart.symbol=symbol;
	stxx.setMasterData(quotes);
	stxx.createDataSet();
	stxx.initializeChart($$("chartContainer"));
	stxx.draw();

	/*
	 * Example of how to create a pre-defined study to display on the screen
	 */
	var inputs={"Period":50,"Field":"Close","Type":"simple"};

	var sd=STXStudies.quickAddStudy(stxx, "ma", inputs);
	sd.permanent=true;	// Optionally prevent users from deleting the study
	
}

function loadIntradayChart(symbol, quotes){
	stxx.setPeriodicityV2(1, 5);
	
	/* Example, setting market open and close times for NYSE */
	stxx.chart.beginHour=9;
	stxx.chart.beginMinute=30;
	stxx.chart.endHour=16;
	stxx.chart.endMinute=0;
	    
	stxx.chart.symbol=symbol;
	stxx.setMasterData(quotes);
	stxx.createDataSet();
	stxx.initializeChart($$("chartContainer"));
	stxx.draw();
	
	/*
	 * Example of how to initialize chart so that entire screen is filled
	 */
	//stxx.layout.candleWidth=stxx.chart.width/(stxx.chart.dataSet.length-14);
	//stxx.chart.maxTicks=Math.round((stxx.chart.width/stxx.layout.candleWidth)-.499)-1;
	//stxx.chart.scroll=stxx.chart.maxTicks;
	//stxx.draw();
	
	/*
	 * Example, how to draw a dashed line on the screen programatically
	 */
	stxx.chart.context.dashedLineTo(0, 0, 100, 100, [3,3]);
	stxx.chart.context.stroke();
}

//This is a sample function to demonstrate how to convert a JavaScript array into an appropriate
//JSON object for the quote engine. Adj_Close should be the closing price adjusted for splits or dividends.
//If that data is not available then set it the same as Close. Most Date formats are supported. Use American
//formats such as MM-DD-YYYY
function convertArrayToJson(quotes){
	var jsObj=[];
	for(var i=0;i<quotes.length;i++){
		jsObj[i]={};
		jsObj[i].Date=quotes[i][0];
		jsObj[i].Open=quotes[i][1];
		jsObj[i].High=quotes[i][2];
		jsObj[i].Low=quotes[i][3];
		jsObj[i].Close=quotes[i][4];
		jsObj[i].Volume=quotes[i][5];
		jsObj[i].Adj_Close=quotes[i][6];
	}
	return jsObj;
}

// This is a sample to demonstrate how the results of the open Yahoo Finance API can be used
// to generate chart data. Be sure to use the Yahoo Finance symbol format (symbology) in the input box
function convertYahooResults(quotes){
	if(quotes && quotes.length==0) return;
	for(var i=0;i<quotes.length;i++){
		quotes[i].Open=parseFloat(quotes[i].Open);
		quotes[i].Close=parseFloat(quotes[i].Close);
		quotes[i].High=parseFloat(quotes[i].High);
		quotes[i].Low=parseFloat(quotes[i].Low);
		quotes[i].Volume=parseFloat(quotes[i].Volume);
		quotes[i].Adj_Close=parseFloat(quotes[i].Adj_Close);
	}
	if(quotes.length>1){	// Weird Yahoo thing where they give duped bars after hours
		if(quotes[quotes.length-1].Date==quotes[quotes.length-2].Date){
			quotes.pop();
		}
	}
}

// Callback function for Yahoo API
function cbfunc(yqlResult){
	var count=yqlResult.query.count;
	if(count>0){
		var quotes=yqlResult.query.results.quote;
		quotes.reverse();
		convertYahooResults(quotes);
		loadChart($$("symbol").value, quotes);
	}
}

// Example of how to retrieve data from Yahoo API. This utilizes so called JSONP concept. Note that Yahoo API is not
// always available. This code does not error check and so a user may simply experience nothing if the Yahoo API
// is down. Do not use in production without adding code to detect "unavailable" responses from Yahoo.
var seq=0;	// Use a sequential counter to prevent IE from caching Yahoo script
function getYahooQuotes(symbol){
	var today=new Date();
	var curr_date = today.getDate();
	if(curr_date<10) curr_date="0" + curr_date;
	var curr_month = today.getMonth()+1;
	if(curr_month<10) curr_month="0" + curr_month;
	var curr_year = today.getFullYear();

	var yyyymmdd=curr_year + "-" + curr_month + "-" + curr_date;
	var yyyymmdd2=(curr_year-1) + "-" + curr_month + "-" + curr_date;
	var url="http://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20yahoo.finance.historicaldata%20where%20symbol%3D'" + symbol + "'%20and%20startDate%3D'" + yyyymmdd2 + "'%20and%20endDate%3D'" + yyyymmdd + "'&format=json&diagnostics=true&env=http%3A%2F%2Fdatatables.org%2Falltables.env&callback=cbfunc" + "&seq=" + seq++;
	var newScript=document.createElement("script");
	newScript.src=url;
	document.body.appendChild(newScript);
}

// Detect hitting the "enter" key in the input box.
function symbolKeyUp(e){
	var div=getEventDOM(e);
	var key = (window.event) ? event.keyCode : e.keyCode;
	switch(key){
		case 13:
			getYahooQuotes($$("symbol").value);
			break;
		case 27:
			$$("symbol").value=stxx.chart.symbol;
			break
		default:
			break;
	}
	e = e||event;
	e.stopPropagation? e.stopPropagation() : e.cancelBubble = true;
}

// These are proxy functions for the chart controls and menus, primarily used to gain access to the stxx object.
function zoomIn(){
	stxx.zoomIn();
}

function zoomOut(){
	stxx.zoomOut();
}

function home(){
	stxx.home();
}

function setChartType(chartType){
	stxx.setChartType(chartType);
}

function setVectorType(vectorType){
	stxx.cancelTouchSingleClick=true;
	stxx.changeVectorType(vectorType);
}

function toggleCrosshairs(){
	stxx.layout.crosshair=!stxx.layout.crosshair;
	stxx.draw();
	stxx.changeOccurred("layout");
	stxx.doDisplayCrosshairs();
}

function toggleLog(){
	stxx.layout.semiLog=!stxx.layout.semiLog;
	stxx.draw();
	stxx.changeOccurred("layout");
	stxx.doDisplayCrosshairs();
}

// Any periodicity is supported for intervals "day", "week" or "month", so long as the data set is large enough. We do not
// include "month" in the sample because Yahoo only returns one year of data. If interval is "minute" then you must
// supply a master data set that is precalculated for the desired periodicity through the callback function STXChart.intradayDataCallback
// Check STXChart.layout.interval and STXChart.layout.periodicity for current values
function setPeriodicity(periodicity, interval){
	stxx.setPeriodicityV2(periodicity, interval);
}

// Creates a new study derived from the contents of the studyDialog that is passed in
function createStudy(){
	STXStudies.go($$("studyDialog"), stxx);	// Note, please add stxx as second parameter in order to translate studies
}

// Creates a panel that contains volume data. Volume panels are always named "vchart"
function createVolumePanel(){
	if(stxx.panelExists("vchart")) return;
	stxx.createPanel("Volume", "vchart", 100);
	stxx.draw();
}

// Underlays volume data under the chart itself
function toggleVolumeUnderlay(){
	stxx.setVolumeUnderlay(!stxx.layout.volumeUnderlay);
}

// Call this function before any modal operations that should suspend chart mouse or touch events
function modalBegin(){
	stxx.openDialog="modal";
	stxx.undisplayCrosshairs();
}

// Call this function to release the modal state. Note the use of cancelTouchSingleClick so that the chart
// does not interpret a closing dialog tap as a chart event
function modalEnd(){
	stxx.cancelTouchSingleClick=true;
	stxx.openDialog="";
	stxx.doDisplayCrosshairs();
}

// Convenience function for dismissing the study dialog. Note that we make sure that the color picker is closed with the dialog.
function dismissDialog(id){
	stxx.openDialog="";
	$$(id).style.display="none";
	if(STXStudies.colorPickerDiv!=null) STXStudies.colorPickerDiv.style.display="none";
}

// Indirection function for creating the study dialog.
function studyDialog(obj, study){
	stxx.openDialog="study";
	$$("studyDialog").querySelectorAll(".title")[0].innerHTML=obj.innerHTML;
	STXStudies.studyDialog(stxx, study, $$("studyDialog"));
}

// Simple menu toggling functionality.
function toggleMenu(menu){
	if($$(menu).style.display=="none"){
		$$(menu).style.display="block";
		stxx.openDialog="menu";
	}else{
		$$(menu).style.display="none";
		stxx.openDialog="";
	}
}

/*
 * Example of how to create a floating date icon on the x-axis that moves with crosshairs
 */

function prependDoDisplayCrosshairs(){
	if((this.layout.crosshair || STXChart.vectorType!="") && this.panels["chart"] && STXChart.crosshairX>0){
		if(stxx.panels["chart"].bottom){
			var floatDate=$$("floatDate");
			floatDate.style.left=(this.backOutX(STXChart.crosshairX)-(floatDate.offsetWidth/2)) + "px";
			floatDate.style.bottom=(this.chart.canvasHeight-this.panels["chart"].bottom) + "px";
			floatDate.style.display="block";
		}else{
			$$("floatDate").style.display="none";			
		}
	}else{
		$$("floatDate").style.display="none";
	}
}

function prependUndisplayCrosshairs(){
	if(this.displayInitialized){
		if(this.chart.crossX.style.display==""){
			$$("floatDate").style.display="none";
		}
	}
}

STXChart.prototype.prepend("doDisplayCrosshairs", prependDoDisplayCrosshairs);
STXChart.prototype.prepend("undisplayCrosshairs", prependUndisplayCrosshairs);

function prependHeadsUpHR(){
	var tick=Math.floor((STXChart.crosshairX-this.chart.left)/this.layout.candleWidth);
	var prices=this.chart.xaxis[tick];
	
	if(prices!=null){
		if(this.internationalizer){
			var str=this.internationalizer.monthDay.format(prices.DT);
			str+=" " + this.internationalizer.hourMinute.format(prices.DT);
			$$("floatDate").innerHTML=str;
		}else{
			$$("floatDate").innerHTML=mmddhhmm(prices.Date);
		}
	}
}

STXChart.prototype.prepend("headsUpHR", prependHeadsUpHR);

/*
 * Example of how to intercept a drawing tool, such as the fib tool in this case, and do something completely different!
 */
function prependMouseup(e){
	if(STXChart.drawingLine==true && STXChart.vectorType=="fib retrace"){
		STXChart.drawingLine=false;
		STXChart.vectorEndY=e.pageY;
		var distance=Math.abs(STXChart.vectorEndY-STXChart.vectorStartY);
		var bottom=Math.min(STXChart.vectorStartY, STXChart.vectorEndY);
		var fibs=[0, .382, .5, .681, 1];
		for(var i=0;i<fibs.length;i++){
			var fib=fibs[i];
			var y=this.backOutY(bottom+distance*fib);
			this.createVector(0,0, y, y, "#000000", "horizontal", {});
			var data={"text":fib.toString(), "w": 50, "h":20, "tail":null};
			var x=this.chart.width-30;
			this.createVector(x,x, y, y, "#000000", "annotation", {}, data);
		}
		STX.clearCanvas(this.chart.tempCanvas, this);
		this.changeOccurred("vector");
		this.draw();
		return true;
	}
}

STXChart.prototype.prepend("mouseup", prependMouseup);


function main(){
	$$("symbol").onkeyup=symbolKeyUp;
}

/*
 * An example of extending native functionality. This simply displays the "home" icon if the chart has been scrolled
 * left. That is, if the "scroll" amount is greater than the size of the screen (maxTicks).
 */
function appendDraw(){
	checkMoreToLoad(this);
	if(this.chart.scroll>this.chart.maxTicks){
		$$("home").style.display="block";
	}else{
		$$("home").style.display="none";
	}
}

STXChart.prototype.append("draw", appendDraw);

/*
 * Example code, how to detect the user has scrolled to the end of data. Present loadMore button which when clicked will fetch
 * more data
 */

var moreToLoad=true;	// Set this to true when you load a new chart. Set it to false whenever the server doesn't have more data to give.
function checkMoreToLoad(stx){
	if(moreToLoad && stx.chart.scroll>=stx.chart.dataSet.length){
		$$("loadMore").style.display="block";
	}else{
		$$("loadMore").style.display="none";
	}
}

function loadMoreData(){
	stxx.cancelTouchSingleClick=true;
	var biggerDataSet=sampleData; // get older data instead of doing this, biggerDataSet
	stxx.setMasterData(convertArrayToJson(biggerDataSet));
	stxx.createDataSet();
	stxx.draw();
}
$$("loadMore").onclick=loadMoreData;

// Code for optional StockChartX Social Chart Sharing
if(typeof(STXSocial)!="undefined"){
	$$("shareButton").style.display="inline-block";
}


/****
 * Example code, how to prevent users from scrolling and creating white space on the right side of the screen
 */
function appendMouseMove(){
	if(this.chart.scroll<this.chart.maxTicks){
		this.chart.scroll=this.chart.maxTicks;
		this.draw();
	}
}

STXChart.prototype.append("mousemove", appendMouseMove);


/*
 * 
 * Example of how to roll your own indicator display with custom canvas drawing
 */
function rsiWithOverbought(stx, sd, quotes){
	if(quotes.length==0) return;
	var panel=stx.panels[sd.panel];
	if(!panel) return;
	if(panel.hidden==true) return;
	panel.axisDrawn=true;	// override the default y-axis
	STXStudies.displaySeriesAsLine(stx, sd, quotes);
	var overBought=80, overSold=20;
	var ypx=panel.height/panel.shadow;
	var overBoughtY=panel.bottom-ypx*overBought;
	var overSoldY=panel.bottom-ypx*overSold;
	stx.chart.context.globalAlpha=.1;
	stx.chart.context.fillStyle="red";
	stx.chart.context.fillRect(0,panel.top,stx.chart.width,overBoughtY-panel.top);

	stx.chart.context.fillStyle="green";
	stx.chart.context.fillRect(0,overSoldY,stx.chart.width,panel.bottom-overSoldY);

	stx.chart.context.globalAlpha=1;

	// Draw the y-axis with overbought/oversold
	var fontHeight=stx.getCanvasFontSize("stx_yaxis");
	stx.canvasFont("stx_yaxis");
	stx.canvasColor("stx_yaxis");
	stx.chart.context.fillText(overBought, stx.chart.width, overBoughtY + (fontHeight/2));
	stx.chart.context.fillText(overSold, stx.chart.width, overSoldY + (fontHeight/2));
	
}

STXStudies.studyLibrary.rsi.seriesFN=rsiWithOverbought;

/*
 * Example of how to feed streaming data into a chart
 */
var streamingData=[
{Date:null,Open:155.43,High:155.44,Low:155.39,Close:155.4,Volume:466380},
{Date:null,Open:155.41,High:155.48,Low:155.4,Close:155.46,Volume:466480},
{Date:null,Open:155.45,High:155.55,Low:155.43,Close:155.5,Volume:466580},
{Date:null,Open:155.49,High:155.51,Low:155.41,Close:155.41,Volume:466680},
{Date:null,Open:155.41,High:155.49,Low:155.38,Close:155.47,Volume:466780},
{Date:null,Open:155.47,High:155.5,Low:155.44,Close:155.45,Volume:466880},
{Date:null,Open:155.45,High:155.47,Low:155.43,Close:155.46,Volume:500},
{Date:null,Open:155.47,High:155.5,Low:155.44,Close:155.48,Volume:1000},
{Date:null,Open:155.49,High:155.49,Low:155.46,Close:155.47,Volume:30000},
{Date:null,Open:155.47,High:155.53,Low:155.46,Close:155.51,Volume:100000},
{Date:null,Open:155.51,High:155.52,Low:155.45,Close:155.47,Volume:3000},
{Date:null,Open:155.46,High:155.47,Low:155.37,Close:155.41,Volume:50000},
{Date:null,Open:155.41,High:155.42,Low:155.38,Close:155.41,Volume:100000},
{Date:null,Open:155.41,High:155.46,Low:155.4,Close:155.45,Volume:400000},
{Date:null,Open:155.32,High:155.48,Low:155.3,Close:155.41,Volume:500000}
];
var streamCounter=0;
var startTick=strToDateTime("2013-03-20 13:40");
var currentTick=startTick;
var streamStartTime=new Date().getTime();

// This method is a very simple streaming simulation to demonstrate how to hook up a streaming feed to your
// charts. This simulation simply runs in a loop. Yours will either do the same and poll, or you could trigger
// off of aysnchronous events.
// Simply use stxx.appendMasterData() to inject new ticks into the chart. Your ticks should be fully formed OHLC
// The chart will not automatically calculate OHLC, that is up to you. It is also up to you to make sure that
// you only inject new ticks that begin on the appropriate interval for the chart. So if your data is based
// off of 5 minute bars then your appended data should also be 5 minute bars.
//
// When ticks are injected with the same starting datetime as the current tick then the new data replaces the existing
// current tick. If ticks are injected with later datetime then they will be appended to the masterData.
//
// Please note that appendMasterData creates a new dataSet with each tick. This means that all of the study calculations
// are recomputed with each tick. If you need faster performance, and are willing to give up automatically calculated studies,
// then manually append to stxx.chart.dataSegment (followed by stxx.draw())

function streamSimulation(){
	// Grab the next tick in the series
	var newTick=clone(streamingData[streamCounter++]);
	if(streamCounter==streamingData.length) streamCounter=0;
	
	// Compute the beginning time of the next bar
	var nextTickTime=STXMarket.nextPeriod(currentTick, stxx.layout.interval, 1, stxx);
	
	// Determine whether to increment the bar time or not
	var now=new Date(startTick.getTime()+(new Date().getTime()-streamStartTime));
	if(now.getTime()>=nextTickTime.getTime()){
		newTick.Date=yyyymmddhhmm(nextTickTime);
		currentTick=nextTickTime;
	}else{
		newTick.Date=yyyymmddhhmm(currentTick);
	}
	// Inject the bar
	stxx.appendMasterData([newTick]);
	
	// Queue the next event
	setTimeout(streamSimulation,250);
}

function displayChart(){
	main();

	loadChart("SAMPLE", convertArrayToJson(sampleData));
	//loadIntradayChart("SAMPLE", convertArrayToJson(sampleDataIntraday));
	//streamSimulation();
}


</script>
</body></html>














